{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./index.js","webpack:///./src/models/feed.js","webpack:///./src/models/user.js","webpack:///./src/resolvers/authorization.js","webpack:///./src/resolvers/feed.js","webpack:///./src/resolvers/index.js","webpack:///./src/resolvers/user.js","webpack:///./src/schemas/feed.js","webpack:///./src/schemas/index.js","webpack:///./src/schemas/user.js","webpack:///external \"apollo-server\"","webpack:///external \"apollo-server-lambda\"","webpack:///external \"bcrypt\"","webpack:///external \"dotenv\"","webpack:///external \"graphql-resolvers\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"mongoose\"","webpack:///external \"mongoose-timestamp\"","webpack:///external \"source-map-support/register\""],"names":["dotenv","config","originDomain","getUser","req","token","headers","jwt","verify","process","env","SECRET","e","AuthenticationError","server","ApolloServer","typeDefs","schemas","resolvers","introspection","playground","endpoint","settings","context","callbackWaitsForEmptyEventLoop","me","models","userModel","feedModel","secret","cachedDb","connectToDatabase","uri","console","log","Promise","resolve","connection","mongoose","connect","autoIndex","reconnectTries","Number","MAX_VALUE","reconnectInterval","poolSize","bufferMaxEntries","keepAlive","useNewUrlParser","set","then","db","catch","err","PROD_MONGODB_URI","exports","graphqlHandler","createHandler","cors","origin","credentials","FeedSchema","Schema","user","type","Types","ObjectId","ref","required","name","String","trim","rss","icon","enabled","Boolean","default","collection","plugin","timestamps","index","createdAt","updatedAt","Feed","model","UserSchema","email","lowercase","unique","password","feeds","pre","hashedPassword","bcrypt","hashSync","User","isAuthenticated","parent","args","skip","ForbiddenError","Query","feed","id","info","findById","_id","exec","find","Mutation","createFeed","combineResolvers","create","author","userResolver","feedResolver","createUser","sign","expiresIn","login","findOne","matchPasswords","compareSync","gql","linkSchema","userSchema","feedSchema"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClFA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEAA,6CAAM,CAACC,MAAP;AAEA,IAAIC,YAAY,GAAG,GAAnB;;AAEA,MAAMC,OAAO,GAAG,MAAOC,GAAP,IAAe;AAC7B,QAAMC,KAAK,GAAGD,GAAG,CAACE,OAAJ,CAAY,SAAZ,CAAd;;AACA,MAAID,KAAJ,EAAW;AACT,QAAI;AACF,aAAO,MAAME,mDAAG,CAACC,MAAJ,CAAWH,KAAX,EAAkBI,OAAO,CAACC,GAAR,CAAYC,MAA9B,CAAb;AACD,KAFD,CAEE,OAAOC,CAAP,EAAU;AACV,YAAM,IAAIC,wEAAJ,CAAwB,sCAAxB,CAAN;AACD;AACF;AACF,CATD;;AAWA,MAAMC,MAAM,GAAG,IAAIC,iEAAJ,CAAiB;AAC9BC,UAAQ,EAAEC,oDADoB;AAE9BC,mEAF8B;AAG9BC,eAAa,EAAE,IAHe;AAI9B;AACAC,YAAU,EAAE;AACVC,YAAQ,EAAE,cADA;AAEVC,YAAQ,EAAE;AACR,6BAAuB;AADf;AAFA,GALkB;AAW9BC,SAAO,EAAE,OAAO;AAAEnB,OAAF;AAAOmB;AAAP,GAAP,KAA4B;AACnCA,WAAO,CAACC,8BAAR,GAAyC,KAAzC;;AACA,QAAIpB,GAAJ,EAAS;AACP,YAAMqB,EAAE,GAAG,MAAMtB,OAAO,CAACC,GAAD,CAAxB;AAEA,aAAO,EACL,GAAGmB,OADE;AAELE,UAFK;AAGLC,cAAM,EAAE;AACNC,6EADM;AAENC,6EAASA;AAFH,SAHH;AAOLC,cAAM,EAAEpB,OAAO,CAACC,GAAR,CAAYC;AAPf,OAAP;AASD;AACF;AA1B6B,CAAjB,CAAf;AA6BA,IAAImB,QAAQ,GAAG,IAAf;;AAEA,SAASC,iBAAT,CAA2BC,GAA3B,EAAgC;AAC9BC,SAAO,CAACC,GAAR,CAAY,wBAAZ;;AAEA,MAAIJ,QAAJ,EAAc;AACZG,WAAO,CAACC,GAAR,CAAY,mCAAZ;AACA,WAAOC,OAAO,CAACC,OAAR,CAAgBN,QAAhB,CAAP;AACD;;AAED,QAAMO,UAAU,GAAGC,+CAAQ,CAACC,OAAT,CAAiBP,GAAjB,EAAsB;AACvCQ,aAAS,EAAE,IAD4B;AAEvCC,kBAAc,EAAEC,MAAM,CAACC,SAFgB;AAGvCC,qBAAiB,EAAE,GAHoB;AAIvCC,YAAQ,EAAE,EAJ6B;AAKvCC,oBAAgB,EAAE,CALqB;AAMvCC,aAAS,EAAE,GAN4B;AAOvCC,mBAAe,EAAE;AAPsB,GAAtB,CAAnB;AAUAV,iDAAQ,CAACW,GAAT,CAAa,gBAAb,EAA+B,IAA/B;AAEA,SAAOZ,UAAU,CACda,IADI,CACEC,EAAD,IAAQ;AACZrB,YAAQ,GAAGqB,EAAX;AACA,WAAOrB,QAAP;AACD,GAJI,EAKJsB,KALI,CAKGC,GAAD,IAAS;AACdpB,WAAO,CAACC,GAAR,CAAYmB,GAAZ;AACD,GAPI,CAAP;AAQD,C,CAED;;;AAEA,MAAMhB,UAAU,GAAGC,+CAAQ,CAACC,OAAT,CAAiB9B,OAAO,CAACC,GAAR,CAAY4C,gBAA7B,EAA+C;AAChEd,WAAS,EAAE,IADqD;AAEhEC,gBAAc,EAAEC,MAAM,CAACC,SAFyC;AAGhEC,mBAAiB,EAAE,GAH6C;AAIhEC,UAAQ,EAAE,EAJsD;AAKhEC,kBAAgB,EAAE,CAL8C;AAMhEC,WAAS,EAAE,GANqD;AAOhEC,iBAAe,EAAE;AAP+C,CAA/C,CAAnB;AAUAV,+CAAQ,CAACW,GAAT,CAAa,gBAAb,EAA+B,IAA/B;AAEAZ,UAAU,CACPa,IADH,CACSC,EAAD,IAAQ;AACZrB,UAAQ,GAAGqB,EAAX;AACA,SAAOrB,QAAP;AACD,CAJH,EAKGsB,KALH,CAKUC,GAAD,IAAS;AACdpB,SAAO,CAACC,GAAR,CAAYmB,GAAZ;AACD,CAPH;AASAE,OAAO,CAACC,cAAR,GAAyB1C,MAAM,CAAC2C,aAAP,CAAqB;AAC5CC,MAAI,EAAE;AACJC,UAAM,EAAE,GADJ;AAEJC,eAAW,EAAE;AAFT,GADsC,CAK5C;AACA;AACA;AACA;AACA;AACA;AACA;;AAX4C,CAArB,CAAzB,C;;;;;;;;;;;;;;;;;;;;;AC9GA;AACA;AAEO,MAAMC,UAAU,GAAG,IAAIC,+CAAJ,CACxB;AACEC,MAAI,EAAE;AACJC,QAAI,EAAEF,+CAAM,CAACG,KAAP,CAAaC,QADf;AAEJC,OAAG,EAAE,MAFD;AAGJ;AACAC,YAAQ,EAAE;AAJN,GADR;AAOEC,MAAI,EAAE;AACJL,QAAI,EAAEM,MADF;AAEJC,QAAI,EAAE,IAFF;AAGJH,YAAQ,EAAE;AAHN,GAPR;AAYEI,KAAG,EAAE;AACHR,QAAI,EAAEM,MADH;AAEHC,QAAI,EAAE,IAFH;AAGHH,YAAQ,EAAE;AAHP,GAZP;AAiBEK,MAAI,EAAE;AACJT,QAAI,EAAEM,MADF;AAEJC,QAAI,EAAE;AAFF,GAjBR;AAqBEG,SAAO,EAAE;AACPV,QAAI,EAAEW,OADC;AAEPC,WAAO,EAAE;AAFF;AArBX,CADwB,EA2BxB;AACEC,YAAU,EAAE;AADd,CA3BwB,CAAnB;AAgCPhB,UAAU,CAACiB,MAAX,CAAkBC,yDAAlB;AAEAlB,UAAU,CAACmB,KAAX,CAAiB;AAAEC,WAAS,EAAE,CAAb;AAAgBC,WAAS,EAAE;AAA3B,CAAjB;AAEA,MAAMC,IAAI,GAAG7C,+CAAQ,CAAC8C,KAAT,CAAe,MAAf,EAAuBvB,UAAvB,CAAb;AAEesB,mEAAf,E;;;;;;;;;;;;;;;;;;;;;;;ACzCA;AACA;AACA;AAEO,MAAME,UAAU,GAAG,IAAIvB,+CAAJ,CACxB;AACEO,MAAI,EAAE;AACJL,QAAI,EAAEM,MADF;AAEJC,QAAI,EAAE,IAFF;AAGJH,YAAQ,EAAE;AAHN,GADR;AAMEkB,OAAK,EAAE;AACLtB,QAAI,EAAEM,MADD;AAELiB,aAAS,EAAE,IAFN;AAGLhB,QAAI,EAAE,IAHD;AAILiB,UAAM,EAAE,IAJH;AAKLpB,YAAQ,EAAE;AALL,GANT;AAaEqB,UAAQ,EAAE;AACRzB,QAAI,EAAEM,MADE;AAERF,YAAQ,EAAE;AAFF,GAbZ;AAiBEsB,OAAK,EAAE,CACL;AACE1B,QAAI,EAAEF,+CAAM,CAACG,KAAP,CAAaC,QADrB;AAEEC,OAAG,EAAE;AAFP,GADK;AAjBT,CADwB,EAyBxB;AACEU,YAAU,EAAE;AADd,CAzBwB,CAAnB;AA8BPQ,UAAU,CAACP,MAAX,CAAkBC,yDAAlB;AAEAM,UAAU,CAACL,KAAX,CAAiB;AAAEC,WAAS,EAAE,CAAb;AAAgBC,WAAS,EAAE;AAA3B,CAAjB;AAEAG,UAAU,CAACM,GAAX,CAAe,MAAf,EAAuB,YAAY;AACjC,QAAMC,cAAc,GAAGC,6CAAM,CAACC,QAAP,CAAgB,KAAKL,QAArB,EAA+B,EAA/B,CAAvB;AACA,OAAKA,QAAL,GAAgBG,cAAhB;AACD,CAHD;AAKA,MAAMG,IAAI,GAAGzD,+CAAQ,CAAC8C,KAAT,CAAe,MAAf,EAAuBC,UAAvB,CAAb;AAEeU,mEAAf,E;;;;;;;;;;;;;;;;;;;;;AC7CA;AACA;AAEO,MAAMC,eAAe,GAAG,CAACC,MAAD,EAASC,IAAT,EAAe;AAAEzE;AAAF,CAAf,KAA2BA,EAAE,GAAG0E,sDAAH,GAAU,IAAIC,4DAAJ,CAAmB,4BAAnB,CAA/D,C;;;;;;;;;;;;;;;;;;;;;ACHP;AACA;AACA;AAEe;AACbC,OAAK,EAAE;AACLC,QAAI,EAAE,OAAOL,MAAP,EAAe;AAAEM;AAAF,KAAf,EAAuB;AAAE7E,YAAM,EAAE;AAAEE;AAAF,OAAV;AAAyBH;AAAzB,KAAvB,EAAsD+E,IAAtD,KAA+D;AACnE,UAAI,CAAC/E,EAAL,EAAS;AACP,cAAM,IAAIZ,iEAAJ,CAAwB,2BAAxB,CAAN;AACD;;AACD,YAAMyF,IAAI,GAAG,MAAM1E,SAAS,CAAC6E,QAAV,CAAmB;AAAEC,WAAG,EAAEH;AAAP,OAAnB,EAAgCI,IAAhC,EAAnB;AACA,aAAOL,IAAP;AACD,KAPI;AAQLZ,SAAK,EAAE,OAAOO,MAAP,EAAeC,IAAf,EAAqB;AAAExE,YAAM,EAAE;AAAEE;AAAF,OAAV;AAAyBH;AAAzB,KAArB,EAAoD+E,IAApD,KAA6D;AAClE,UAAI,CAAC/E,EAAL,EAAS;AACP,cAAM,IAAIZ,iEAAJ,CAAwB,wBAAxB,CAAN;AACD;;AACD,YAAM6E,KAAK,GAAG,MAAM9D,SAAS,CAACgF,IAAV,CAAe;AAAE7C,YAAI,EAAEtC,EAAE,CAAC8E;AAAX,OAAf,EAAgCI,IAAhC,EAApB;AACA,aAAOjB,KAAP;AACD;AAdI,GADM;AAiBbmB,UAAQ,EAAE;AACRC,cAAU,EAAEC,0EAAgB,CAC1Bf,8DAD0B,EAE1B,OAAOC,MAAP,EAAe;AAAE5B,UAAF;AAAQG,SAAR;AAAaC;AAAb,KAAf,EAAoC;AAAE/C,YAAM,EAAE;AAAEE;AAAF,OAAV;AAAyBH;AAAzB,KAApC,EAAmE+E,IAAnE,KAA4E;AAC1E,UAAI,CAAC/E,EAAL,EAAS;AACP,cAAM,IAAIZ,iEAAJ,CAAwB,2BAAxB,CAAN;AACD;;AACD,YAAMyF,IAAI,GAAG,MAAM1E,SAAS,CAACoF,MAAV,CAAiB;AAAE3C,YAAF;AAAQG,WAAR;AAAaC,YAAb;AAAmBC,eAAO,EAAE,IAA5B;AAAkCX,YAAI,EAAEtC,EAAE,CAAC8E;AAA3C,OAAjB,CAAnB;AACA,aAAOD,IAAP;AACD,KARyB;AADpB,GAjBG;AA6BbnB,MAAI,EAAE;AACJpB,QAAI,EAAE,OAAO;AAAEkD;AAAF,KAAP,EAAmBf,IAAnB,EAAyB;AAAExE,YAAM,EAAE;AAAEC;AAAF;AAAV,KAAzB,EAAoD6E,IAApD,KAA6D;AACjE,YAAMzC,IAAI,GAAG,MAAMpC,SAAS,CAAC8E,QAAV,CAAmB;AAAEC,WAAG,EAAEO;AAAP,OAAnB,EAAoCN,IAApC,EAAnB;AACA,aAAO5C,IAAP;AACD;AAJG;AA7BO,CAAf,E;;;;;;;;;;;;;;;;;;ACJA;AACA;AAEe,gEAACmD,6CAAD,EAAeC,6CAAf,CAAf,E;;;;;;;;;;;;;;;;;;;;;;ACHA;AACA;AACA;AAEe;AACbd,OAAK,EAAE;AACLtC,QAAI,EAAE,OAAOkC,MAAP,EAAe;AAAEM;AAAF,KAAf,EAAuB;AAAE7E,YAAM,EAAE;AAAEC;AAAF,OAAV;AAAyBF;AAAzB,KAAvB,EAAsD+E,IAAtD,KAA+D;AACnE;AACA,UAAI,CAAC/E,EAAL,EAAS;AACP,cAAM,IAAIZ,iEAAJ,CAAwB,2BAAxB,CAAN;AACD;;AACD,YAAMkD,IAAI,GAAG,MAAMpC,SAAS,CAAC8E,QAAV,CAAmB;AAAEC,WAAG,EAAEH;AAAP,OAAnB,EAAgCI,IAAhC,EAAnB;AACA,aAAO5C,IAAP;AACD;AARI,GADM;AAWb8C,UAAQ,EAAE;AACRO,cAAU,EAAE,OAAOnB,MAAP,EAAe;AAAE5B,UAAF;AAAQiB,WAAR;AAAeG;AAAf,KAAf,EAA0C;AAAE/D,YAAM,EAAE;AAAEC;AAAF,OAAV;AAAyBE;AAAzB,KAA1C,EAA6E2E,IAA7E,KAAsF;AAChG,YAAMzC,IAAI,GAAG,MAAMpC,SAAS,CAACqF,MAAV,CAAiB;AAAE3C,YAAF;AAAQiB,aAAR;AAAeG;AAAf,OAAjB,CAAnB;AACA,YAAMpF,KAAK,GAAGE,mDAAG,CAAC8G,IAAJ,CAAS;AAAEd,UAAE,EAAExC,IAAI,CAACwC;AAAX,OAAT,EAA0B1E,MAA1B,EAAkC;AAAEyF,iBAAS,EAAE,KAAK,EAAL,GAAU;AAAvB,OAAlC,CAAd;AACA,aAAO;AAAEjH;AAAF,OAAP;AACD,KALO;AAMRkH,SAAK,EAAE,OAAOtB,MAAP,EAAe;AAAEX,WAAF;AAASG;AAAT,KAAf,EAAoC;AAAE/D,YAAM,EAAE;AAAEC;AAAF,OAAV;AAAyBE;AAAzB,KAApC,EAAuE2E,IAAvE,KAAgF;AACrF,YAAMzC,IAAI,GAAG,MAAMpC,SAAS,CAAC6F,OAAV,CAAkB;AAAElC;AAAF,OAAlB,EAA6BqB,IAA7B,EAAnB;;AAEA,UAAI,CAAC5C,IAAL,EAAW;AACT,cAAM,IAAIlD,iEAAJ,CAAwB,qBAAxB,CAAN;AACD;;AAED,YAAM4G,cAAc,GAAG5B,6CAAM,CAAC6B,WAAP,CAAmBjC,QAAnB,EAA6B1B,IAAI,CAAC0B,QAAlC,CAAvB;;AAEA,UAAI,CAACgC,cAAL,EAAqB;AACnB,cAAM,IAAI5G,iEAAJ,CAAwB,qBAAxB,CAAN;AACD;;AAED,YAAMR,KAAK,GAAGE,mDAAG,CAAC8G,IAAJ,CAAS;AAAEd,UAAE,EAAExC,IAAI,CAACwC;AAAX,OAAT,EAA0B1E,MAA1B,EAAkC;AAAEyF,iBAAS,EAAE,KAAK,EAAL,GAAU;AAAvB,OAAlC,CAAd;AAEA,aAAO;AACLjH;AADK,OAAP;AAGD;AAxBO,GAXG;AAqCb0F,MAAI,EAAE;AACJL,SAAK,EAAE,OAAO;AAAEa;AAAF,KAAP,EAAeL,IAAf,EAAqB;AAAExE,YAAM,EAAE;AAAEE;AAAF;AAAV,KAArB,EAAgD4E,IAAhD,KAAyD;AAC9D,YAAMd,KAAK,GAAG,MAAM9D,SAAS,CAACgF,IAAV,CAAe;AAAE7C,YAAI,EAAEwC;AAAR,OAAf,EAA6BI,IAA7B,EAApB;AACA,aAAOjB,KAAP;AACD;AAJG;AArCO,CAAf,E;;;;;;;;;;;;;;;;;;ACJA;AAEeiC,gHAAI;;;;;;;;;;;;;;;;;;;;;;;;CAAnB,E;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AAEA,MAAMC,UAAU,GAAGD,iDAAI;;;;;;;CAAvB;AASe,gEAACC,UAAD,EAAaC,6CAAb,EAAyBC,6CAAzB,CAAf,E;;;;;;;;;;;;;;;;;;ACbA;AAEeH,gHAAI;;;;;;;;;;;;;;;;;;;;CAAnB,E;;;;;;;;;;;ACFA,0C;;;;;;;;;;;ACAA,iD;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,8C;;;;;;;;;;;ACAA,yC;;;;;;;;;;;ACAA,qC;;;;;;;;;;;ACAA,+C;;;;;;;;;;;ACAA,wD","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","import dotenv from 'dotenv';\nimport jwt from 'jsonwebtoken';\nimport mongoose from 'mongoose';\nimport { ApolloServer, AuthenticationError } from 'apollo-server-lambda';\n\nimport schemas from './src/schemas';\nimport resolvers from './src/resolvers';\n\nimport userModel from './src/models/user';\nimport feedModel from './src/models/feed';\n\ndotenv.config();\n\nlet originDomain = '*';\n\nconst getUser = async (req) => {\n  const token = req.headers['x-token'];\n  if (token) {\n    try {\n      return await jwt.verify(token, process.env.SECRET);\n    } catch (e) {\n      throw new AuthenticationError('Your session expired. Sign in again.');\n    }\n  }\n};\n\nconst server = new ApolloServer({\n  typeDefs: schemas,\n  resolvers,\n  introspection: true,\n  // playground: process.env.NODE_ENV === 'dev' ? true : false,\n  playground: {\n    endpoint: '/dev/graphql',\n    settings: {\n      'request.credentials': 'same-origin',\n    },\n  },\n  context: async ({ req, context }) => {\n    context.callbackWaitsForEmptyEventLoop = false;\n    if (req) {\n      const me = await getUser(req);\n\n      return {\n        ...context,\n        me,\n        models: {\n          userModel,\n          feedModel,\n        },\n        secret: process.env.SECRET,\n      };\n    }\n  },\n});\n\nlet cachedDb = null;\n\nfunction connectToDatabase(uri) {\n  console.log('=> connect to database');\n\n  if (cachedDb) {\n    console.log('=> using cached database instance');\n    return Promise.resolve(cachedDb);\n  }\n\n  const connection = mongoose.connect(uri, {\n    autoIndex: true,\n    reconnectTries: Number.MAX_VALUE,\n    reconnectInterval: 500,\n    poolSize: 50,\n    bufferMaxEntries: 0,\n    keepAlive: 120,\n    useNewUrlParser: true,\n  });\n\n  mongoose.set('useCreateIndex', true);\n\n  return connection\n    .then((db) => {\n      cachedDb = db;\n      return cachedDb;\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n}\n\n// connectToDatabase(process.env.PROD_MONGODB_URI).then((db) => console.log(`connected to db`));\n\nconst connection = mongoose.connect(process.env.PROD_MONGODB_URI, {\n  autoIndex: true,\n  reconnectTries: Number.MAX_VALUE,\n  reconnectInterval: 500,\n  poolSize: 50,\n  bufferMaxEntries: 0,\n  keepAlive: 120,\n  useNewUrlParser: true,\n});\n\nmongoose.set('useCreateIndex', true);\n\nconnection\n  .then((db) => {\n    cachedDb = db;\n    return cachedDb;\n  })\n  .catch((err) => {\n    console.log(err);\n  });\n\nexports.graphqlHandler = server.createHandler({\n  cors: {\n    origin: '*',\n    credentials: true,\n  },\n  // cors: {\n  //   origin: originDomain,\n  //   credentials: true,\n  //   methods: 'POST, GET, OPTIONS',\n  //   allowedHeaders: ['Content-Type', 'X-Amz-Date', 'Authorization', 'X-Api-Key', 'X-Amz-Security-Token', 'x-token'],\n  // },\n  // endpointURL: '/graphql',\n});\n","import mongoose, { Schema } from 'mongoose';\nimport timestamps from 'mongoose-timestamp';\n\nexport const FeedSchema = new Schema(\n  {\n    user: {\n      type: Schema.Types.ObjectId,\n      ref: 'User',\n      // TODO\n      required: true,\n    },\n    name: {\n      type: String,\n      trim: true,\n      required: true,\n    },\n    rss: {\n      type: String,\n      trim: true,\n      required: true,\n    },\n    icon: {\n      type: String,\n      trim: true,\n    },\n    enabled: {\n      type: Boolean,\n      default: true,\n    },\n  },\n  {\n    collection: 'feeds',\n  }\n);\n\nFeedSchema.plugin(timestamps);\n\nFeedSchema.index({ createdAt: 1, updatedAt: 1 });\n\nconst Feed = mongoose.model('Feed', FeedSchema);\n\nexport default Feed;\n","import mongoose, { Schema } from 'mongoose';\nimport timestamps from 'mongoose-timestamp';\nimport bcrypt from 'bcrypt';\n\nexport const UserSchema = new Schema(\n  {\n    name: {\n      type: String,\n      trim: true,\n      required: true,\n    },\n    email: {\n      type: String,\n      lowercase: true,\n      trim: true,\n      unique: true,\n      required: true,\n    },\n    password: {\n      type: String,\n      required: true,\n    },\n    feeds: [\n      {\n        type: Schema.Types.ObjectId,\n        ref: 'Feed',\n      },\n    ],\n  },\n  {\n    collection: 'users',\n  }\n);\n\nUserSchema.plugin(timestamps);\n\nUserSchema.index({ createdAt: 1, updatedAt: 1 });\n\nUserSchema.pre('save', function () {\n  const hashedPassword = bcrypt.hashSync(this.password, 12);\n  this.password = hashedPassword;\n});\n\nconst User = mongoose.model('User', UserSchema);\n\nexport default User;\n","import { ForbiddenError } from 'apollo-server';\nimport { skip } from 'graphql-resolvers';\n\nexport const isAuthenticated = (parent, args, { me }) => (me ? skip : new ForbiddenError('Not authenticated as user.'));\n","import { AuthenticationError } from 'apollo-server';\nimport { combineResolvers } from 'graphql-resolvers';\nimport { isAuthenticated } from './authorization';\n\nexport default {\n  Query: {\n    feed: async (parent, { id }, { models: { feedModel }, me }, info) => {\n      if (!me) {\n        throw new AuthenticationError('You are not authenticated');\n      }\n      const feed = await feedModel.findById({ _id: id }).exec();\n      return feed;\n    },\n    feeds: async (parent, args, { models: { feedModel }, me }, info) => {\n      if (!me) {\n        throw new AuthenticationError('You are not logged in.');\n      }\n      const feeds = await feedModel.find({ user: me.id }).exec();\n      return feeds;\n    },\n  },\n  Mutation: {\n    createFeed: combineResolvers(\n      isAuthenticated,\n      async (parent, { name, rss, icon }, { models: { feedModel }, me }, info) => {\n        if (!me) {\n          throw new AuthenticationError('You are not authenticated');\n        }\n        const feed = await feedModel.create({ name, rss, icon, enabled: true, user: me.id });\n        return feed;\n      }\n    ),\n  },\n  Feed: {\n    user: async ({ author }, args, { models: { userModel } }, info) => {\n      const user = await userModel.findById({ _id: author }).exec();\n      return user;\n    },\n  },\n};\n","import feedResolver from './feed';\nimport userResolver from './user';\n\nexport default [userResolver, feedResolver];\n","import bcrypt from 'bcrypt';\nimport jwt from 'jsonwebtoken';\nimport { AuthenticationError } from 'apollo-server';\n\nexport default {\n  Query: {\n    user: async (parent, { id }, { models: { userModel }, me }, info) => {\n      // ? Reason for being authenticated first\n      if (!me) {\n        throw new AuthenticationError('You are not authenticated');\n      }\n      const user = await userModel.findById({ _id: id }).exec();\n      return user;\n    },\n  },\n  Mutation: {\n    createUser: async (parent, { name, email, password }, { models: { userModel }, secret }, info) => {\n      const user = await userModel.create({ name, email, password });\n      const token = jwt.sign({ id: user.id }, secret, { expiresIn: 24 * 10 * 50 });\n      return { token };\n    },\n    login: async (parent, { email, password }, { models: { userModel }, secret }, info) => {\n      const user = await userModel.findOne({ email }).exec();\n\n      if (!user) {\n        throw new AuthenticationError('Invalid credentials');\n      }\n\n      const matchPasswords = bcrypt.compareSync(password, user.password);\n\n      if (!matchPasswords) {\n        throw new AuthenticationError('Invalid credentials');\n      }\n\n      const token = jwt.sign({ id: user.id }, secret, { expiresIn: 24 * 10 * 50 });\n\n      return {\n        token,\n      };\n    },\n  },\n  User: {\n    feeds: async ({ id }, args, { models: { feedModel } }, info) => {\n      const feeds = await feedModel.find({ user: id }).exec();\n      return feeds;\n    },\n  },\n};\n","import { gql } from 'apollo-server';\n\nexport default gql`\n  type Feed {\n    id: ID!\n    name: String\n    rss: String\n    icon: String\n    enabled: Boolean\n    user: User!\n  }\n\n  input CreateFeedInput {\n    name: String!\n    rss: String!\n    icon: String!\n  }\n\n  extend type Query {\n    feeds: [Feed!]\n    feed(id: ID!): Feed!\n  }\n\n  extend type Mutation {\n    createFeed(input: CreateFeedInput!): Feed!\n  }\n`;\n","import userSchema from './user';\nimport feedSchema from './feed';\nimport { gql } from 'apollo-server';\n\nconst linkSchema = gql`\n  type Query {\n    _: Boolean\n  }\n  type Mutation {\n    _: Boolean\n  }\n`;\n\nexport default [linkSchema, userSchema, feedSchema];\n","import { gql } from 'apollo-server';\n\nexport default gql`\n  type User {\n    id: ID!\n    name: String!\n    email: String!\n    feeds: [Feed!]\n  }\n\n  type Token {\n    token: String!\n  }\n\n  extend type Query {\n    user(id: ID!): User!\n  }\n\n  extend type Mutation {\n    createUser(name: String!, email: String!, password: String!): Token!\n    login(email: String!, password: String!): Token!\n  }\n`;\n","module.exports = require(\"apollo-server\");","module.exports = require(\"apollo-server-lambda\");","module.exports = require(\"bcrypt\");","module.exports = require(\"dotenv\");","module.exports = require(\"graphql-resolvers\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"mongoose\");","module.exports = require(\"mongoose-timestamp\");","module.exports = require(\"source-map-support/register\");"],"sourceRoot":""}